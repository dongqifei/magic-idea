import{K as tt,Q as ot,h as P,W as A,A as T,V as at,E as R,D as Y,M as C,S as D,i as K,L as lt,j as O,B as V,k as dt,l as G,n as J,o as q,q as ht,C as ct,s as ut,u as ft,v as bt,w as pt,x as mt,y as gt,U as _t,Y as L,z as vt,G as Tt,N as yt,F as Bt,H as Et,I as xt,J as St,O as wt}from"./index-Oj7xzQpQ.js";import{X as Gt,R as Yt}from"./index-Oj7xzQpQ.js";import{E as At,a as et,b as U,c as Ct,d as it,e as Dt}from"./monaco-model-service-Dr7hbA1E.js";import{D as Xt}from"./monaco-model-service-Dr7hbA1E.js";class rt{matches(t){return t.editorType===At.DEFAULT}getResourceInfo(t){return{resourceUri:t.resourceUri||t.id}}getSplitOptions(t){return{}}}var zt=Object.getOwnPropertyDescriptor,kt=(n,t,e,i)=>{for(var r=i>1?void 0:i?zt(t,e):t,s=n.length-1,o;s>=0;s--)(o=n[s])&&(r=o(r)||r);return r},Mt=(n,t)=>(e,i)=>t(e,i,n);let F=class{constructor(n){this.strategies=n}getStrategy(n){for(const t of this.strategies)if(t.matches(n))return t;return new rt}registerStrategy(n){this.strategies.unshift(n)}};F=kt([tt(),Mt(0,ot(et))],F);const Lt=["ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End"];class W extends A{constructor(t={}){super({node:k.createNode()}),this.addClass("lm-TabBar"),this.contentNode.setAttribute("role","tablist"),this.setFlag(A.Flag.DisallowLayout),this._document=t.document||document,this.tabsMovable=t.tabsMovable||!1,this.titlesEditable=t.titlesEditable||!1,this.allowDeselect=t.allowDeselect||!1,this.addButtonEnabled=t.addButtonEnabled||!1,this._scrollingEnabled=t.scrollingEnabled||!1,this.insertBehavior=t.insertBehavior||"select-tab-if-needed",this.name=t.name||"",this.orientation=t.orientation||"horizontal",this.removeBehavior=t.removeBehavior||"select-tab-after",this.renderer=t.renderer||W.defaultRenderer}dispose(){this._releaseMouse(),this._titles.length=0,this._previousTitle=null,super.dispose()}get currentChanged(){return this._currentChanged}get tabMoved(){return this._tabMoved}get tabActivateRequested(){return this._tabActivateRequested}get addRequested(){return this._addRequested}get tabCloseRequested(){return this._tabCloseRequested}get tabDetachRequested(){return this._tabDetachRequested}renderer;get document(){return this._document}tabsMovable;get titlesEditable(){return this._titlesEditable}set titlesEditable(t){this._titlesEditable=t}allowDeselect;insertBehavior;removeBehavior;get currentTitle(){return this._titles[this._currentIndex]||null}set currentTitle(t){this.currentIndex=t?this._titles.indexOf(t):-1}get currentIndex(){return this._currentIndex}set currentIndex(t){if((t<0||t>=this._titles.length)&&(t=-1),this._currentIndex===t)return;let e=this._currentIndex,i=this._titles[e]||null,r=t,s=this._titles[r]||null;this._currentIndex=r,this._previousTitle=i,this.update(),this._currentChanged.emit({previousIndex:e,previousTitle:i,currentIndex:r,currentTitle:s})}get name(){return this._name}set name(t){this._name=t,t?this.contentNode.setAttribute("aria-label",t):this.contentNode.removeAttribute("aria-label")}get orientation(){return this._orientation}set orientation(t){this._orientation!==t&&(this._releaseMouse(),this._orientation=t,this.dataset.orientation=t,this.contentNode.setAttribute("aria-orientation",t))}get addButtonEnabled(){return this._addButtonEnabled}set addButtonEnabled(t){this._addButtonEnabled!==t&&(this._addButtonEnabled=t,t?this.addButtonNode.classList.remove("lm-mod-hidden"):this.addButtonNode.classList.add("lm-mod-hidden"))}get scrollingEnabled(){return this._scrollingEnabled}set scrollingEnabled(t){this._scrollingEnabled!==t&&(this._scrollingEnabled=t,t?this.node.classList.add("lm-mod-scrollable"):this.node.classList.remove("lm-mod-scrollable"),this.maybeSwitchScrollButtons())}get titles(){return this._titles}get contentNode(){return this.node.getElementsByClassName("lm-TabBar-content")[0]}get contentWrapperNode(){return this.node.getElementsByClassName("lm-TabBar-wrapper")[0]}get addButtonNode(){return this.node.getElementsByClassName("lm-TabBar-addButton")[0]}get scrollBeforeButtonNode(){return this.node.getElementsByClassName("lm-TabBar-scrollBeforeButton")[0]}get scrollAfterButtonNode(){return this.node.getElementsByClassName("lm-TabBar-scrollAfterButton")[0]}addTab(t){return this.insertTab(this._titles.length,t)}insertTab(t,e){this._releaseMouse();let i=k.asTitle(e),r=this._titles.indexOf(i),s=Math.max(0,Math.min(t,this._titles.length));return r===-1?(T.insert(this._titles,s,i),i.changed.connect(this._onTitleChanged,this),this.update(),this._adjustCurrentForInsert(s,i),i):(s===this._titles.length&&s--,r===s||(T.move(this._titles,r,s),this.update(),this._adjustCurrentForMove(r,s)),i)}removeTab(t){this.removeTabAt(this._titles.indexOf(t))}removeTabAt(t){this._releaseMouse();let e=T.removeAt(this._titles,t);e&&(e.changed.disconnect(this._onTitleChanged,this),e===this._previousTitle&&(this._previousTitle=null),this.update(),this._adjustCurrentForRemove(t,e))}clearTabs(){if(this._titles.length===0)return;this._releaseMouse();for(let i of this._titles)i.changed.disconnect(this._onTitleChanged,this);let t=this.currentIndex,e=this.currentTitle;this._currentIndex=-1,this._previousTitle=null,this._titles.length=0,this.update(),t!==-1&&this._currentChanged.emit({previousIndex:t,previousTitle:e,currentIndex:-1,currentTitle:null})}releaseMouse(){this._releaseMouse()}handleEvent(t){switch(t.type){case"pointerdown":this._evtPointerDown(t);break;case"pointermove":this._evtPointerMove(t);break;case"pointerup":this._evtPointerUp(t);break;case"dblclick":this._evtDblClick(t);break;case"keydown":t.eventPhase===Event.CAPTURING_PHASE?this._evtKeyDownCapturing(t):this._evtKeyDown(t);break;case"contextmenu":t.preventDefault(),t.stopPropagation();break;case"scroll":this._evtScroll(t);break;case"wheel":this._evtWheel(t),t.preventDefault();break}}onBeforeAttach(t){this.node.addEventListener("pointerdown",this),this.node.addEventListener("dblclick",this),this.node.addEventListener("keydown",this),this.contentNode.addEventListener("scroll",this),this.contentNode.addEventListener("wheel",this)}onAfterDetach(t){this.node.removeEventListener("pointerdown",this),this.node.removeEventListener("dblclick",this),this.node.removeEventListener("keydown",this),this.contentNode.removeEventListener("scroll",this),this.contentNode.removeEventListener("wheel",this),this._releaseMouse()}onUpdateRequest(t){let e=this._titles,i=this.renderer,r=this.currentTitle,s=new Array(e.length);const o=this._getCurrentTabindex()??(this._currentIndex>-1?this._currentIndex:0);for(let l=0,p=e.length;l<p;++l){let c=e[l],d=c===r,b=d?p:p-l-1,h=o===l?0:-1;s[l]=i.renderTab({title:c,current:d,zIndex:b,tabIndex:h})}at.render(s,this.contentNode),this.maybeSwitchScrollButtons(),this.scrollCurrentIntoView()}onResize(t){super.onResize(t),this.maybeSwitchScrollButtons()}scrollCurrentIntoView(){if(this.scrollingEnabled){const t=this.contentNode,e=t.children.item(this.currentIndex);e?(e.scrollIntoView(),this.orientation=="horizontal"?t.scrollTop=0:t.scrollLeft=0):console.error("Current tab node not found")}}maybeSwitchScrollButtons(){const t=this.scrollBeforeButtonNode,e=this.scrollAfterButtonNode,i=this._scrollState;this.scrollingEnabled&&i.totalSize>i.displayedSize?(t.classList.remove("lm-mod-hidden"),e.classList.remove("lm-mod-hidden")):(t.classList.add("lm-mod-hidden"),e.classList.add("lm-mod-hidden")),this.updateScrollingHints(i)}updateScrollingHints(t){const e=this.contentWrapperNode;if(!this.scrollingEnabled){delete e.dataset.canScroll;return}const i=t.position!=0,r=t.position!=t.totalSize-t.displayedSize;i&&r?e.dataset.canScroll="both":i?e.dataset.canScroll="before":r?e.dataset.canScroll="after":delete e.dataset.canScroll}get _scrollState(){const t=this.contentNode,e=t.getBoundingClientRect(),i=this.orientation==="horizontal",r=i?e.width:e.height,s=i?t.scrollWidth:t.scrollHeight,o=Math.round(i?t.scrollLeft:t.scrollTop);return{displayedSize:Math.round(r),totalSize:s,position:o}}_evtScroll(t){this.updateScrollingHints(this._scrollState)}_evtWheel(t){this.scrollBy(t.deltaY*.4)}_getCurrentTabindex(){let t=null;const e=this.contentNode.querySelector('li[tabindex="0"]');return e?t=[...this.contentNode.children].indexOf(e):this._addButtonEnabled&&this.addButtonNode.getAttribute("tabindex")==="0"&&(t=-1),t}_evtDblClick(t){if(!this.titlesEditable)return;let e=this.contentNode.children,i=T.findFirstIndex(e,o=>R.hitTest(o,t.clientX,t.clientY));if(i===-1)return;let r=this.titles[i],s=e[i].querySelector(".lm-TabBar-tabLabel");if(s&&s.contains(t.target)){let o=r.label||"",l=s.innerHTML;s.innerHTML="";let p=document.createElement("input");p.classList.add("lm-TabBar-tabInput"),p.value=o,s.appendChild(p);let c=()=>{p.removeEventListener("blur",c),s.innerHTML=l,this.node.addEventListener("keydown",this)};p.addEventListener("dblclick",d=>d.stopPropagation()),p.addEventListener("blur",c),p.addEventListener("keydown",d=>{d.key==="Enter"?(p.value!==""&&(r.label=r.caption=p.value),c()):d.key==="Escape"&&c()}),this.node.removeEventListener("keydown",this),p.select(),p.focus(),s.children.length>0&&s.children[0].focus()}}_evtKeyDownCapturing(t){t.eventPhase===Event.CAPTURING_PHASE&&(t.preventDefault(),t.stopPropagation(),t.key==="Escape"&&this._releaseMouse())}scrollBy(t){const e=this.orientation,i=this.contentNode;e=="horizontal"?i.scrollLeft+=t:i.scrollTop+=t,this._lastMouseEvent&&this._evtPointerMove(this._lastMouseEvent)}_evtKeyDown(t){if(!(t.key==="Tab"||t.eventPhase===Event.CAPTURING_PHASE)){if(t.key==="Enter"||t.key==="Spacebar"||t.key===" "){const e=document.activeElement;if(this.addButtonEnabled&&this.addButtonNode.contains(e))t.preventDefault(),t.stopPropagation(),this._addRequested.emit();else{const i=T.findFirstIndex(this.contentNode.children,r=>r.contains(e));i>=0&&(t.preventDefault(),t.stopPropagation(),this.currentIndex=i)}}else if(Lt.includes(t.key)){const e=[...this.contentNode.children];if(this.addButtonEnabled&&e.push(this.addButtonNode),e.length<=1)return;t.preventDefault(),t.stopPropagation();let i=e.indexOf(document.activeElement);i===-1&&(i=this._currentIndex);let r;t.key==="ArrowRight"&&this._orientation==="horizontal"||t.key==="ArrowDown"&&this._orientation==="vertical"?r=e[i+1]??e[0]:t.key==="ArrowLeft"&&this._orientation==="horizontal"||t.key==="ArrowUp"&&this._orientation==="vertical"?r=e[i-1]??e[e.length-1]:t.key==="Home"?r=e[0]:t.key==="End"&&(r=e[e.length-1]),r&&(e[i]?.setAttribute("tabindex","-1"),r?.setAttribute("tabindex","0"),r.focus())}}}beginScrolling(t){let s=performance.now();const o=()=>{if(!this._scrollData){this.stopScrolling();return}const p=performance.now(),c=(p-s)/1e3;s=p;const d=this._scrollData.rate,b=this._scrollData.direction,h=(b=="+"?1:-1)*d*c;this.scrollBy(h),this._scrollData.rate=Math.min(this._scrollData.rate+80*c,450);const a=this._scrollState;if(b=="-"&&a.position==0||b=="+"&&a.totalSize==a.position+a.displayedSize){this.stopScrolling();return}window.requestAnimationFrame(o)},l=!this._scrollData;this._scrollData={direction:t,rate:150},l&&window.requestAnimationFrame(o)}stopScrolling(){if(!this._scrollData)return;this._scrollData=null;const t=this._scrollState;this.updateScrollingHints(t)}_evtPointerDown(t){if(t.button!==0&&t.button!==1||this._dragData||t.target.classList.contains("lm-TabBar-tabInput"))return;let e=this.addButtonEnabled&&this.addButtonNode.contains(t.target),i=this.scrollingEnabled&&this.scrollBeforeButtonNode.contains(t.target),r=this.scrollingEnabled&&this.scrollAfterButtonNode.contains(t.target);const s=e||r||i,o=this.contentNode;let l=this.contentNode.children,p=T.findFirstIndex(l,d=>R.hitTest(d,t.clientX,t.clientY));if(p===-1&&!s)return;if(t.preventDefault(),t.stopPropagation(),this._dragData={tab:l[p],index:p,pressX:t.clientX,pressY:t.clientY,initialScrollPosition:this.orientation=="horizontal"?o.scrollLeft:o.scrollTop,tabPos:-1,tabSize:-1,tabPressPos:-1,targetIndex:-1,tabLayout:null,contentRect:null,override:null,dragActive:!1,dragAborted:!1,detachRequested:!1},this.document.addEventListener("pointerup",this,!0),i||r){this.beginScrolling(i?"-":"+");return}if(this._clickedTabIndex=p,t.button===1||e)return;let c=l[p].querySelector(this.renderer.closeIconSelector);c&&c.contains(t.target)||(this.tabsMovable&&(this.document.addEventListener("pointermove",this,!0),this.document.addEventListener("keydown",this,!0),this.document.addEventListener("contextmenu",this,!0)),this.allowDeselect&&this.currentIndex===p?this.currentIndex=-1:this.currentIndex=p,this.currentIndex!==-1&&this._tabActivateRequested.emit({index:this.currentIndex,title:this.currentTitle}))}_evtPointerMove(t){let e=this.scrollingEnabled&&this.scrollBeforeButtonNode.contains(t.target),i=this.scrollingEnabled&&this.scrollAfterButtonNode.contains(t.target);const r=e||i;r||this.stopScrolling();let s=this._dragData;if(!s)return;t.preventDefault(),t.stopPropagation(),r&&this.beginScrolling(e?"-":"+");let o=this.contentNode.children;if(!(!s.dragActive&&!k.dragExceeded(s,t,this._scrollState))){if(!s.dragActive){let l=s.tab.getBoundingClientRect();this._orientation==="horizontal"?(s.tabPos=s.tab.offsetLeft,s.tabSize=l.width,s.tabPressPos=s.pressX-l.left):(s.tabPos=s.tab.offsetTop,s.tabSize=l.height,s.tabPressPos=s.pressY-l.top),s.tabPressOffset={x:s.pressX-l.left,y:s.pressY-l.top},s.tabLayout=k.snapTabLayout(o,this._orientation),s.contentRect=this.contentNode.getBoundingClientRect(),s.override=Y.overrideCursor("default"),s.tab.classList.add("lm-mod-dragging"),this.addClass("lm-mod-dragging"),s.dragActive=!0}if(!s.detachRequested&&k.detachExceeded(s,t)){s.detachRequested=!0;let l=s.index,p=t.clientX,c=t.clientY,d=o[l],b=this._titles[l];if(this._tabDetachRequested.emit({index:l,title:b,tab:d,clientX:p,clientY:c,offset:s.tabPressOffset}),s.dragAborted)return}k.layoutTabs(o,s,t,this._orientation,this._scrollState)}}_evtPointerUp(t){if(t.button!==0&&t.button!==1)return;const e=this._dragData;if(!e)return;if(t.preventDefault(),t.stopPropagation(),this.document.removeEventListener("pointermove",this,!0),this.document.removeEventListener("pointerup",this,!0),this.document.removeEventListener("keydown",this,!0),this.document.removeEventListener("contextmenu",this,!0),!e.dragActive){if(this._dragData=null,this._scrollData&&this.stopScrolling(),this.addButtonEnabled&&this.addButtonNode.contains(t.target)){this._addRequested.emit(void 0);return}let s=this.contentNode.children,o=T.findFirstIndex(s,c=>R.hitTest(c,t.clientX,t.clientY));if(o!==this._clickedTabIndex||o===-1&&this._clickedTabIndex===-1)return;let l=this._titles[o];if(!l.closable)return;if(t.button===1){this._tabCloseRequested.emit({index:o,title:l});return}let p=s[o].querySelector(this.renderer.closeIconSelector);if(p&&p.contains(t.target)){this._tabCloseRequested.emit({index:o,title:l});return}return}if(t.button!==0)return;k.finalizeTabPosition(e,this._orientation,this._scrollState),e.tab.classList.remove("lm-mod-dragging");let i=k.parseTransitionDuration(e.tab);setTimeout(()=>{if(e.dragAborted)return;this._dragData=null,k.resetTabPositions(this.contentNode.children,this._orientation),e.override.dispose(),this.removeClass("lm-mod-dragging");let r=e.index,s=e.targetIndex;s===-1||r===s||(T.move(this._titles,r,s),this._adjustCurrentForMove(r,s),this._tabMoved.emit({fromIndex:r,toIndex:s,title:this._titles[s]}),C.sendMessage(this,A.Msg.UpdateRequest))},i)}_releaseMouse(){let t=this._dragData;t&&(this._dragData=null,this.document.removeEventListener("pointermove",this,!0),this.document.removeEventListener("pointerup",this,!0),this.document.removeEventListener("keydown",this,!0),this.document.removeEventListener("contextmenu",this,!0),t.dragAborted=!0,t.dragActive&&(k.resetTabPositions(this.contentNode.children,this._orientation),t.override.dispose(),t.tab.classList.remove("lm-mod-dragging"),this.removeClass("lm-mod-dragging")))}_adjustCurrentForInsert(t,e){let i=this.currentTitle,r=this._currentIndex,s=this.insertBehavior;if(s==="select-tab"||s==="select-tab-if-needed"&&r===-1){this._currentIndex=t,this._previousTitle=i,this._currentChanged.emit({previousIndex:r,previousTitle:i,currentIndex:t,currentTitle:e});return}r>=t&&this._currentIndex++}_adjustCurrentForMove(t,e){this._currentIndex===t?this._currentIndex=e:this._currentIndex<t&&this._currentIndex>=e?this._currentIndex++:this._currentIndex>t&&this._currentIndex<=e&&this._currentIndex--}_adjustCurrentForRemove(t,e){let i=this._currentIndex,r=this.removeBehavior;if(i!==t){i>t&&this._currentIndex--;return}if(this._titles.length===0){this._currentIndex=-1,this._currentChanged.emit({previousIndex:t,previousTitle:e,currentIndex:-1,currentTitle:null});return}if(r==="select-tab-after"){this._currentIndex=Math.min(t,this._titles.length-1),this._currentChanged.emit({previousIndex:t,previousTitle:e,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}if(r==="select-tab-before"){this._currentIndex=Math.max(0,t-1),this._currentChanged.emit({previousIndex:t,previousTitle:e,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}if(r==="select-previous-tab"){this._previousTitle?(this._currentIndex=this._titles.indexOf(this._previousTitle),this._previousTitle=null):this._currentIndex=Math.min(t,this._titles.length-1),this._currentChanged.emit({previousIndex:t,previousTitle:e,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}this._currentIndex=-1,this._currentChanged.emit({previousIndex:t,previousTitle:e,currentIndex:-1,currentTitle:null})}_onTitleChanged(t){this.update()}_clickedTabIndex=-1;_name;_currentIndex=-1;_titles=[];_orientation;_document;_lastMouseEvent=null;_titlesEditable=!1;_previousTitle=null;_dragData=null;_scrollData=null;_addButtonEnabled=!1;_scrollingEnabled=!1;_tabMoved=new D(this);_currentChanged=new D(this);_addRequested=new D(this);_tabCloseRequested=new D(this);_tabDetachRequested=new D(this);_tabActivateRequested=new D(this)}(n=>{class t{constructor(){this._uuid=++t._nInstance}closeIconSelector=".lm-TabBar-tabCloseIcon";renderTab(i){let r=i.title.caption,s=this.createTabKey(i),o=s,l=this.createTabStyle(i),p=this.createTabClass(i),c=this.createTabDataset(i),d=this.createTabARIA(i);return i.title.closable?P.li({id:o,key:s,className:p,title:r,style:l,dataset:c,...d},this.renderIcon(i),this.renderLabel(i),this.renderCloseIcon(i)):P.li({id:o,key:s,className:p,title:r,style:l,dataset:c,...d},this.renderIcon(i),this.renderLabel(i))}renderIcon(i){const{title:r}=i;let s=this.createIconClass(i);return P.div({className:s},r.icon,r.iconLabel)}renderLabel(i){return P.div({className:"lm-TabBar-tabLabel"},i.title.label)}renderCloseIcon(i){return P.div({className:"lm-TabBar-tabCloseIcon"})}createTabKey(i){let r=this._tabKeys.get(i.title);return r===void 0&&(r=`tab-key-${this._uuid}-${this._tabID++}`,this._tabKeys.set(i.title,r)),r}createTabStyle(i){return{zIndex:`${i.zIndex}`}}createTabClass(i){let r="lm-TabBar-tab";return i.title.className&&(r+=` ${i.title.className}`),i.title.closable&&(r+=" lm-mod-closable"),i.current&&(r+=" lm-mod-current"),r}createTabDataset(i){return i.title.dataset}createTabARIA(i){return{role:"tab","aria-selected":i.current.toString(),tabindex:`${i.tabIndex??"-1"}`}}createIconClass(i){let r="lm-TabBar-tabIcon",s=i.title.iconClass;return s?`${r} ${s}`:r}static _nInstance=0;_uuid;_tabID=0;_tabKeys=new WeakMap}n.Renderer=t,n.defaultRenderer=new t,n.addButtonSelector=".lm-TabBar-addButton"})(W||(W={}));var k;(n=>{n.DRAG_THRESHOLD=5,n.DETACH_THRESHOLD=20;function t(){let d=document.createElement("div"),b=document.createElement("ul");b.setAttribute("role","tablist"),b.className="lm-TabBar-content";let h=document.createElement("div");h.className="lm-TabBar-wrapper",h.appendChild(b),d.appendChild(h);let a=document.createElement("div");a.className="lm-TabBar-button lm-TabBar-scrollButton lm-TabBar-scrollBeforeButton lm-mod-hidden",a.setAttribute("role","button");let f=document.createElement("div");f.className="lm-TabBar-button lm-TabBar-scrollButton lm-TabBar-scrollAfterButton lm-mod-hidden",f.setAttribute("role","button"),d.appendChild(a),d.appendChild(f);let u=document.createElement("div");return u.className="lm-TabBar-button lm-TabBar-addButton lm-mod-hidden",u.setAttribute("tabindex","-1"),u.setAttribute("role","button"),d.appendChild(u),d}n.createNode=t;function e(d){return d instanceof K?d:new K(d)}n.asTitle=e;function i(d){let b=window.getComputedStyle(d);return 1e3*(parseFloat(b.transitionDuration)||0)}n.parseTransitionDuration=i;function r(d,b){let h=new Array(d.length);for(let a=0,f=d.length;a<f;++a){let u=d[a],m=window.getComputedStyle(u);b==="horizontal"?h[a]={pos:u.offsetLeft,size:u.offsetWidth,margin:parseFloat(m.marginLeft)||0}:h[a]={pos:u.offsetTop,size:u.offsetHeight,margin:parseFloat(m.marginTop)||0}}return h}n.snapTabLayout=r;function s(d,b,h){let a=Math.abs(b.clientX-d.pressX),f=Math.abs(b.clientY-d.pressY),u=h?Math.abs(d.initialScrollPosition-h.position):0;return a>=n.DRAG_THRESHOLD||f>=n.DRAG_THRESHOLD||u>=n.DRAG_THRESHOLD}n.dragExceeded=s;function o(d,b){let h=d.contentRect;return b.clientX<h.left-n.DETACH_THRESHOLD||b.clientX>=h.right+n.DETACH_THRESHOLD||b.clientY<h.top-n.DETACH_THRESHOLD||b.clientY>=h.bottom+n.DETACH_THRESHOLD}n.detachExceeded=o;function l(d,b,h,a,f){let u,m,g;const B=f.totalSize,_=f.position-b.initialScrollPosition;a==="horizontal"?(u=b.pressX-_,m=h.clientX-b.contentRect.left+f.position,g=h.clientX):(u=b.pressY-_,m=h.clientY-b.contentRect.top+f.position,g=h.clientY);let S=b.index,y=m-b.tabPressPos,E=y+b.tabSize;for(let v=0,H=d.length;v<H;++v){let M,z=b.tabLayout[v],j=z.pos+(z.size>>1);if(v<b.index&&y<j)M=`${b.tabSize+b.tabLayout[v+1].margin}px`,S=Math.min(S,v);else if(v>b.index&&E>j)M=`${-b.tabSize-z.margin}px`,S=Math.max(S,v);else if(v===b.index){let st=g-u,nt=B-(b.tabPos+b.tabSize);M=`${Math.max(-b.tabPos,Math.min(st,nt))}px`}else M="";a==="horizontal"?d[v].style.left=M:d[v].style.top=M}b.targetIndex=S}n.layoutTabs=l;function p(d,b,h){const a=h.totalSize;let f;if(d.targetIndex===d.index)f=0;else if(d.targetIndex>d.index){let g=d.tabLayout[d.targetIndex];f=g.pos+g.size-d.tabSize-d.tabPos}else f=d.tabLayout[d.targetIndex].pos-d.tabPos;let u=a-(d.tabPos+d.tabSize),m=Math.max(-d.tabPos,Math.min(f,u));b==="horizontal"?d.tab.style.left=`${m}px`:d.tab.style.top=`${m}px`}n.finalizeTabPosition=p;function c(d,b){for(const h of d)b==="horizontal"?h.style.left="":h.style.top=""}n.resetTabPositions=c})(k||(k={}));var $;(n=>{function t(e){return Math.max(0,Math.floor(e))}n.clampDimension=t})($||($={}));class It extends lt{constructor(t){super(),this.renderer=t.renderer,t.spacing!==void 0&&(this._spacing=$.clampDimension(t.spacing)),this._document=t.document||document,this._hiddenMode=t.hiddenMode!==void 0?t.hiddenMode:A.HiddenMode.Display}dispose(){let t=this[Symbol.iterator]();this._items.forEach(e=>{e.dispose()}),this._box=null,this._root=null,this._items.clear();for(const e of t)e.dispose();super.dispose()}renderer;get hiddenMode(){return this._hiddenMode}set hiddenMode(t){if(this._hiddenMode!==t){this._hiddenMode=t;for(const e of this.tabBars())if(e.titles.length>1)for(const i of e.titles)i.owner.hiddenMode=this._hiddenMode}}get spacing(){return this._spacing}set spacing(t){t=$.clampDimension(t),this._spacing!==t&&(this._spacing=t,this.parent&&this.parent.fit())}get isEmpty(){return this._root===null}[Symbol.iterator](){return this._root?this._root.iterAllWidgets():O()}widgets(){return this._root?this._root.iterUserWidgets():O()}selectedWidgets(){return this._root?this._root.iterSelectedWidgets():O()}tabBars(){return this._root?this._root.iterTabBars():O()}handles(){return this._root?this._root.iterHandles():O()}moveHandle(t,e,i){let r=t.classList.contains("lm-mod-hidden");if(!this._root||r)return;let s=this._root.findSplitNode(t);if(!s)return;let o;s.node.orientation==="horizontal"?o=e-t.offsetLeft:o=i-t.offsetTop,o!==0&&(s.node.holdSizes(),V.adjust(s.node.sizers,s.index,o),this.parent&&this.parent.update())}saveLayout(){return this._root?(this._root.holdAllSizes(),{main:this._root.createConfig()}):{main:null}}restoreLayout(t){let e=new Set,i;t.main?i=w.normalizeAreaConfig(t.main,e):i=null;let r=this.widgets(),s=this.tabBars(),o=this.handles();this._root=null;for(const l of r)e.has(l)||(l.parent=null);for(const l of s)l.dispose();for(const l of o)l.parentNode&&l.parentNode.removeChild(l);for(const l of e)l.parent=this.parent;i?this._root=w.realizeAreaConfig(i,{createTabBar:l=>this._createTabBar(),createHandle:()=>this._createHandle()},this._document):this._root=null,this.parent&&(e.forEach(l=>{this.attachWidget(l)}),this.parent.fit())}addWidget(t,e={}){let i=e.ref||null,r=e.mode||"tab-after",s=null;if(this._root&&i&&(s=this._root.findTabNode(i)),i&&!s)throw new Error("Reference widget is not in the layout.");switch(t.parent=this.parent,r){case"tab-after":this._insertTab(t,i,s,!0);break;case"tab-before":this._insertTab(t,i,s,!1);break;case"split-top":this._insertSplit(t,i,s,"vertical",!1);break;case"split-left":this._insertSplit(t,i,s,"horizontal",!1);break;case"split-right":this._insertSplit(t,i,s,"horizontal",!0);break;case"split-bottom":this._insertSplit(t,i,s,"vertical",!0);break;case"merge-top":this._insertSplit(t,i,s,"vertical",!1,!0);break;case"merge-left":this._insertSplit(t,i,s,"horizontal",!1,!0);break;case"merge-right":this._insertSplit(t,i,s,"horizontal",!0,!0);break;case"merge-bottom":this._insertSplit(t,i,s,"vertical",!0,!0);break}this.parent&&(this.attachWidget(t),this.parent.fit())}removeWidget(t){this._removeWidget(t),this.parent&&(this.detachWidget(t),this.parent.fit())}hitTestTabAreas(t,e){if(!this._root||!this.parent||!this.parent.isVisible)return null;this._box||(this._box=R.boxSizing(this.parent.node));let i=this.parent.node.getBoundingClientRect(),r=t-i.left-this._box.borderLeft,s=e-i.top-this._box.borderTop,o=this._root.hitTestTabNodes(r,s);if(!o)return null;let{tabBar:l,top:p,left:c,width:d,height:b}=o,h=this._box.borderLeft+this._box.borderRight,a=this._box.borderTop+this._box.borderBottom,f=i.width-h-(c+d),u=i.height-a-(p+b);return{tabBar:l,x:r,y:s,top:p,left:c,right:f,bottom:u,width:d,height:b}}init(){super.init();for(const t of this)this.attachWidget(t);for(const t of this.handles())this.parent.node.appendChild(t);this.parent.fit()}attachWidget(t){this.parent.node!==t.node.parentNode&&(this._items.set(t,new dt(t)),this.parent.isAttached&&C.sendMessage(t,A.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.isAttached&&C.sendMessage(t,A.Msg.AfterAttach))}detachWidget(t){if(this.parent.node!==t.node.parentNode)return;this.parent.isAttached&&C.sendMessage(t,A.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&C.sendMessage(t,A.Msg.AfterDetach);let e=this._items.get(t);e&&(this._items.delete(t),e.dispose())}onBeforeShow(t){super.onBeforeShow(t),this.parent.update()}onBeforeAttach(t){super.onBeforeAttach(t),this.parent.fit()}onChildShown(t){this.parent.fit()}onChildHidden(t){this.parent.fit()}onResize(t){this.parent.isVisible&&this._update(t.width,t.height)}onUpdateRequest(t){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(t){this.parent.isAttached&&this._fit()}_removeWidget(t){if(!this._root)return;let e=this._root.findTabNode(t);if(!e)return;if(w.removeAria(t),e.tabBar.titles.length>1){if(e.tabBar.removeTab(t.title),this._hiddenMode===A.HiddenMode.Scale&&e.tabBar.titles.length==1){const h=e.tabBar.titles[0].owner;h.hiddenMode=A.HiddenMode.Display}return}if(e.tabBar.dispose(),this._root===e){this._root=null;return}this._root.holdAllSizes();let i=e.parent;e.parent=null;let r=T.removeFirstOf(i.children,e),s=T.removeAt(i.handles,r);if(T.removeAt(i.sizers,r),s.parentNode&&s.parentNode.removeChild(s),i.children.length>1){i.syncHandles();return}let o=i.parent;i.parent=null;let l=i.children[0],p=i.handles[0];if(i.children.length=0,i.handles.length=0,i.sizers.length=0,p.parentNode&&p.parentNode.removeChild(p),this._root===i){l.parent=null,this._root=l;return}let c=o,d=c.children.indexOf(i);if(l instanceof w.TabLayoutNode){l.parent=c,c.children[d]=l;return}let b=T.removeAt(c.handles,d);T.removeAt(c.children,d),T.removeAt(c.sizers,d),b.parentNode&&b.parentNode.removeChild(b);for(let h=0,a=l.children.length;h<a;++h){let f=l.children[h],u=l.handles[h],m=l.sizers[h];T.insert(c.children,d+h,f),T.insert(c.handles,d+h,u),T.insert(c.sizers,d+h,m),f.parent=c}l.children.length=0,l.handles.length=0,l.sizers.length=0,l.parent=null,c.syncHandles()}_createTabNode(t){let e=new w.TabLayoutNode(this._createTabBar());return e.tabBar.addTab(t.title),w.addAria(t,e.tabBar),e}_insertTab(t,e,i,r){if(t===e)return;if(!this._root){let o=new w.TabLayoutNode(this._createTabBar());o.tabBar.addTab(t.title),this._root=o,w.addAria(t,o.tabBar);return}i||(i=this._root.findFirstTabNode()),i.tabBar.titles.indexOf(t.title)===-1&&(this._removeWidget(t),t.hide());let s;if(e?s=i.tabBar.titles.indexOf(e.title):s=i.tabBar.currentIndex,this._hiddenMode===A.HiddenMode.Scale)if(i.tabBar.titles.length===0)t.hiddenMode=A.HiddenMode.Display;else if(i.tabBar.titles.length==1){const o=i.tabBar.titles[0].owner;o.hiddenMode=A.HiddenMode.Scale}else t.hiddenMode=A.HiddenMode.Scale;else t.hiddenMode=this._hiddenMode;i.tabBar.insertTab(s+(r?1:0),t.title),w.addAria(t,i.tabBar)}_insertSplit(t,e,i,r,s,o=!1){if(t===e&&i&&i.tabBar.titles.length===1)return;if(this._removeWidget(t),!this._root){this._root=this._createTabNode(t);return}if(!i||!i.parent){let h=this._splitRoot(r),a=s?h.children.length:0;h.normalizeSizes();let f=w.createSizer(i?1:w.GOLDEN_RATIO),u=this._createTabNode(t);T.insert(h.children,a,u),T.insert(h.sizers,a,f),T.insert(h.handles,a,this._createHandle()),u.parent=h,h.normalizeSizes(),h.syncHandles();return}let l=i.parent;if(l.orientation===r){let h=l.children.indexOf(i);if(o){let m=h+(s?1:-1),g=l.children[m];if(g instanceof w.TabLayoutNode){this._insertTab(t,null,g,!0),++g.tabBar.currentIndex;return}}l.normalizeSizes();let a=l.sizers[h].sizeHint/=2,f=h+(s?1:0),u=this._createTabNode(t);T.insert(l.children,f,u),T.insert(l.sizers,f,w.createSizer(a)),T.insert(l.handles,f,this._createHandle()),u.parent=l,l.syncHandles();return}let p=T.removeFirstOf(l.children,i),c=new w.SplitLayoutNode(r);c.normalized=!0,c.children.push(i),c.sizers.push(w.createSizer(.5)),c.handles.push(this._createHandle()),i.parent=c;let d=s?1:0,b=this._createTabNode(t);T.insert(c.children,d,b),T.insert(c.sizers,d,w.createSizer(.5)),T.insert(c.handles,d,this._createHandle()),b.parent=c,c.syncHandles(),T.insert(l.children,p,c),c.parent=l}_splitRoot(t){let e=this._root;if(e instanceof w.SplitLayoutNode&&e.orientation===t)return e;let i=this._root=new w.SplitLayoutNode(t);return e&&(i.children.push(e),i.sizers.push(w.createSizer(0)),i.handles.push(this._createHandle()),e.parent=i),i}_fit(){let t=0,e=0;if(this._root){let s=this._root.fit(this._spacing,this._items);t=s.minWidth,e=s.minHeight}let i=this._box=R.boxSizing(this.parent.node);t+=i.horizontalSum,e+=i.verticalSum;let r=this.parent.node.style;r.minWidth=`${t}px`,r.minHeight=`${e}px`,this._dirty=!0,this.parent.parent&&C.sendMessage(this.parent.parent,A.Msg.FitRequest),this._dirty&&C.sendMessage(this.parent,A.Msg.UpdateRequest)}_update(t,e){if(this._dirty=!1,!this._root)return;t<0&&(t=this.parent.node.offsetWidth),e<0&&(e=this.parent.node.offsetHeight),this._box||(this._box=R.boxSizing(this.parent.node));let i=this._box.paddingTop,r=this._box.paddingLeft,s=t-this._box.horizontalSum,o=e-this._box.verticalSum;this._root.update(i,r,s,o,this._spacing,this._items)}_createTabBar(){let t=this.renderer.createTabBar(this._document);return t.orientation="horizontal",this.parent&&this.attachWidget(t),t}_createHandle(){let t=this.renderer.createHandle(),e=t.style;return e.position="absolute",e.contain="strict",e.top="0",e.left="0",e.width="0",e.height="0",this.parent&&this.parent.node.appendChild(t),t}_spacing=4;_dirty=!1;_root=null;_box=null;_document;_hiddenMode;_items=new Map}var w;(n=>{n.GOLDEN_RATIO=.618;function t(h){let a=new G;return a.sizeHint=h,a.size=h,a}n.createSizer=t;function e(h,a){let f;return h.type==="tab-area"?f=p(h,a):f=c(h,a),f}n.normalizeAreaConfig=e;function i(h,a,f){let u;return h.type==="tab-area"?u=d(h,a,f):u=b(h,a,f),u}n.realizeAreaConfig=i;class r{constructor(a){let f=new G,u=new G;f.stretch=0,u.stretch=1,this.tabBar=a,this.sizers=[f,u]}parent=null;tabBar;sizers;get top(){return this._top}get left(){return this._left}get width(){return this._width}get height(){return this._height}*iterAllWidgets(){yield this.tabBar,yield*this.iterUserWidgets()}*iterUserWidgets(){for(const a of this.tabBar.titles)yield a.owner}*iterSelectedWidgets(){let a=this.tabBar.currentTitle;a&&(yield a.owner)}*iterTabBars(){yield this.tabBar}*iterHandles(){}findTabNode(a){return this.tabBar.titles.indexOf(a.title)!==-1?this:null}findSplitNode(a){return null}findFirstTabNode(){return this}hitTestTabNodes(a,f){return a<this._left||a>=this._left+this._width||f<this._top||f>=this._top+this._height?null:this}createConfig(){let a=this.tabBar.titles.map(u=>u.owner),f=this.tabBar.currentIndex;return{type:"tab-area",widgets:a,currentIndex:f}}holdAllSizes(){}fit(a,f){let u=0,m=0,g=1/0,B=1/0,_=f.get(this.tabBar),S=this.tabBar.currentTitle,y=S?f.get(S.owner):void 0,[E,v]=this.sizers;return _&&_.fit(),y&&y.fit(),_&&!_.isHidden?(u=Math.max(u,_.minWidth),m+=_.minHeight,E.minSize=_.minHeight,E.maxSize=_.maxHeight):(E.minSize=0,E.maxSize=0),y&&!y.isHidden?(u=Math.max(u,y.minWidth),m+=y.minHeight,v.minSize=y.minHeight,v.maxSize=1/0):(v.minSize=0,v.maxSize=1/0),{minWidth:u,minHeight:m,maxWidth:g,maxHeight:B}}update(a,f,u,m,g,B){this._top=f,this._left=a,this._width=u,this._height=m;let _=B.get(this.tabBar),S=this.tabBar.currentTitle,y=S?B.get(S.owner):void 0;if(V.calc(this.sizers,m),_&&!_.isHidden){let E=this.sizers[0].size;_.update(a,f,u,E),f+=E}if(y&&!y.isHidden){let E=this.sizers[1].size;y.update(a,f,u,E)}}_top=0;_left=0;_width=0;_height=0}n.TabLayoutNode=r;class s{constructor(a){this.orientation=a}parent=null;normalized=!1;orientation;children=[];sizers=[];handles=[];*iterAllWidgets(){for(const a of this.children)yield*a.iterAllWidgets()}*iterUserWidgets(){for(const a of this.children)yield*a.iterUserWidgets()}*iterSelectedWidgets(){for(const a of this.children)yield*a.iterSelectedWidgets()}*iterTabBars(){for(const a of this.children)yield*a.iterTabBars()}*iterHandles(){yield*this.handles;for(const a of this.children)yield*a.iterHandles()}findTabNode(a){for(let f=0,u=this.children.length;f<u;++f){let m=this.children[f].findTabNode(a);if(m)return m}return null}findSplitNode(a){let f=this.handles.indexOf(a);if(f!==-1)return{index:f,node:this};for(let u=0,m=this.children.length;u<m;++u){let g=this.children[u].findSplitNode(a);if(g)return g}return null}findFirstTabNode(){return this.children.length===0?null:this.children[0].findFirstTabNode()}hitTestTabNodes(a,f){for(let u=0,m=this.children.length;u<m;++u){let g=this.children[u].hitTestTabNodes(a,f);if(g)return g}return null}createConfig(){let a=this.orientation,f=this.createNormalizedSizes(),u=this.children.map(m=>m.createConfig());return{type:"split-area",orientation:a,children:u,sizes:f}}syncHandles(){this.handles.forEach((a,f)=>{a.setAttribute("data-orientation",this.orientation),f===this.handles.length-1?a.classList.add("lm-mod-hidden"):a.classList.remove("lm-mod-hidden")})}holdSizes(){for(const a of this.sizers)a.sizeHint=a.size}holdAllSizes(){for(const a of this.children)a.holdAllSizes();this.holdSizes()}normalizeSizes(){let a=this.sizers.length;if(a===0)return;this.holdSizes();let f=this.sizers.reduce((u,m)=>u+m.sizeHint,0);if(f===0)for(const u of this.sizers)u.size=u.sizeHint=1/a;else for(const u of this.sizers)u.size=u.sizeHint/=f;this.normalized=!0}createNormalizedSizes(){let a=this.sizers.length;if(a===0)return[];let f=this.sizers.map(m=>m.size),u=f.reduce((m,g)=>m+g,0);if(u===0)for(let m=f.length-1;m>-1;m--)f[m]=1/a;else for(let m=f.length-1;m>-1;m--)f[m]/=u;return f}fit(a,f){let u=this.orientation==="horizontal",m=Math.max(0,this.children.length-1)*a,g=u?m:0,B=u?0:m,_=1/0,S=1/0;for(let y=0,E=this.children.length;y<E;++y){let v=this.children[y].fit(a,f);u?(B=Math.max(B,v.minHeight),g+=v.minWidth,this.sizers[y].minSize=v.minWidth):(g=Math.max(g,v.minWidth),B+=v.minHeight,this.sizers[y].minSize=v.minHeight)}return{minWidth:g,minHeight:B,maxWidth:_,maxHeight:S}}update(a,f,u,m,g,B){let _=this.orientation==="horizontal",S=Math.max(0,this.children.length-1)*g,y=Math.max(0,(_?u:m)-S);if(this.normalized){for(const E of this.sizers)E.sizeHint*=y;this.normalized=!1}V.calc(this.sizers,y);for(let E=0,v=this.children.length;E<v;++E){let H=this.children[E],M=this.sizers[E].size,z=this.handles[E].style;_?(H.update(a,f,M,m,g,B),a+=M,z.top=`${f}px`,z.left=`${a}px`,z.width=`${g}px`,z.height=`${m}px`,a+=g):(H.update(a,f,u,M,g,B),f+=M,z.top=`${f}px`,z.left=`${a}px`,z.width=`${u}px`,z.height=`${g}px`,f+=g)}}}n.SplitLayoutNode=s;function o(h,a){h.node.setAttribute("role","tabpanel");let f=a.renderer;if(f instanceof W.Renderer){let u=f.createTabKey({title:h.title,current:!1,zIndex:0});h.node.setAttribute("aria-labelledby",u)}}n.addAria=o;function l(h){h.node.removeAttribute("role"),h.node.removeAttribute("aria-labelledby")}n.removeAria=l;function p(h,a){if(h.widgets.length===0)return null;let f=[];for(const m of h.widgets)a.has(m)||(a.add(m),f.push(m));if(f.length===0)return null;let u=h.currentIndex;return u!==-1&&(u<0||u>=f.length)&&(u=0),{type:"tab-area",widgets:f,currentIndex:u}}function c(h,a){let f=h.orientation,u=[],m=[];for(let g=0,B=h.children.length;g<B;++g){let _=e(h.children[g],a);_&&(_.type==="tab-area"||_.orientation!==f?(u.push(_),m.push(Math.abs(h.sizes[g]||0))):(u.push(..._.children),m.push(..._.sizes)))}return u.length===0?null:u.length===1?u[0]:{type:"split-area",orientation:f,children:u,sizes:m}}function d(h,a,f){let u=a.createTabBar(f);for(const m of h.widgets)m.hide(),u.addTab(m.title),n.addAria(m,u);return u.currentIndex=h.currentIndex,new r(u)}function b(h,a,f){let u=new s(h.orientation);return h.children.forEach((m,g)=>{let B=i(m,a,f),_=t(h.sizes[g]),S=a.createHandle();u.children.push(B),u.handles.push(S),u.sizers.push(_),B.parent=u}),u.syncHandles(),u.normalizeSizes(),u}})(w||(w={}));class N extends A{constructor(t={}){super(),this.addClass("lm-DockPanel"),this._document=t.document||document,this._mode=t.mode||"multiple-document",this._renderer=t.renderer||N.defaultRenderer,this._edges=t.edges||x.DEFAULT_EDGES,t.tabsMovable!==void 0&&(this._tabsMovable=t.tabsMovable),t.tabsConstrained!==void 0&&(this._tabsConstrained=t.tabsConstrained),t.addButtonEnabled!==void 0&&(this._addButtonEnabled=t.addButtonEnabled),t.tabScrollingEnabled!==void 0&&(this._tabScrollingEnabled=t.tabScrollingEnabled),this.dataset.mode=this._mode;let e={createTabBar:()=>this._createTabBar(),createHandle:()=>this._createHandle()};this.layout=new It({document:this._document,renderer:e,spacing:t.spacing,hiddenMode:t.hiddenMode}),this.overlay=t.overlay||new N.Overlay,this.node.appendChild(this.overlay.node)}dispose(){this._releaseMouse(),this.overlay.hide(0),this._drag&&this._drag.dispose(),super.dispose()}get hiddenMode(){return this.layout.hiddenMode}set hiddenMode(t){this.layout.hiddenMode=t}get layoutModified(){return this._layoutModified}get addRequested(){return this._addRequested}overlay;get renderer(){return this.layout.renderer}get spacing(){return this.layout.spacing}set spacing(t){this.layout.spacing=t}get mode(){return this._mode}set mode(t){if(this._mode===t)return;this._mode=t,this.dataset.mode=t;let e=this.layout;switch(t){case"multiple-document":for(const i of e.tabBars())i.show();break;case"single-document":e.restoreLayout(x.createSingleDocumentConfig(this));break;default:throw"unreachable"}C.postMessage(this,x.LayoutModified)}get tabsMovable(){return this._tabsMovable}set tabsMovable(t){this._tabsMovable=t;for(const e of this.tabBars())e.tabsMovable=t}get tabsConstrained(){return this._tabsConstrained}set tabsConstrained(t){this._tabsConstrained=t}get addButtonEnabled(){return this._addButtonEnabled}set addButtonEnabled(t){this._addButtonEnabled=t;for(const e of this.tabBars())e.addButtonEnabled=t}get tabScrollingEnabled(){return this._tabScrollingEnabled}set tabScrollingEnabled(t){this._tabScrollingEnabled=t;for(const e of this.tabBars())e.scrollingEnabled=t}get isEmpty(){return this.layout.isEmpty}*widgets(){yield*this.layout.widgets()}*selectedWidgets(){yield*this.layout.selectedWidgets()}*tabBars(){yield*this.layout.tabBars()}*handles(){yield*this.layout.handles()}selectWidget(t){let e=J(this.tabBars(),i=>i.titles.indexOf(t.title)!==-1);if(!e)throw new Error("Widget is not contained in the dock panel.");e.currentTitle=t.title}activateWidget(t){this.selectWidget(t),t.activate()}saveLayout(){return this.layout.saveLayout()}restoreLayout(t){this._mode="multiple-document",this.layout.restoreLayout(t),(q.IS_EDGE||q.IS_IE)&&C.flush(),C.postMessage(this,x.LayoutModified)}addWidget(t,e={}){this._mode==="single-document"?this.layout.addWidget(t):this.layout.addWidget(t,e),C.postMessage(this,x.LayoutModified)}processMessage(t){t.type==="layout-modified"?this._layoutModified.emit(void 0):super.processMessage(t)}handleEvent(t){switch(t.type){case"lm-dragenter":this._evtDragEnter(t);break;case"lm-dragleave":this._evtDragLeave(t);break;case"lm-dragover":this._evtDragOver(t);break;case"lm-drop":this._evtDrop(t);break;case"pointerdown":this._evtPointerDown(t);break;case"pointermove":this._evtPointerMove(t);break;case"pointerup":this._evtPointerUp(t);break;case"keydown":this._evtKeyDown(t);break;case"contextmenu":t.preventDefault(),t.stopPropagation();break}}onBeforeAttach(t){this.node.addEventListener("lm-dragenter",this),this.node.addEventListener("lm-dragleave",this),this.node.addEventListener("lm-dragover",this),this.node.addEventListener("lm-drop",this),this.node.addEventListener("pointerdown",this)}onAfterDetach(t){this.node.removeEventListener("lm-dragenter",this),this.node.removeEventListener("lm-dragleave",this),this.node.removeEventListener("lm-dragover",this),this.node.removeEventListener("lm-drop",this),this.node.removeEventListener("pointerdown",this),this._releaseMouse()}onChildAdded(t){x.isGeneratedTabBarProperty.get(t.child)||t.child.addClass("lm-DockPanel-widget")}onChildRemoved(t){x.isGeneratedTabBarProperty.get(t.child)||(t.child.removeClass("lm-DockPanel-widget"),C.postMessage(this,x.LayoutModified))}_evtDragEnter(t){t.mimeData.hasData("application/vnd.lumino.widget-factory")&&(t.preventDefault(),t.stopPropagation())}_evtDragLeave(t){t.preventDefault(),!(this._tabsConstrained&&t.source!==this)&&(t.stopPropagation(),this.overlay.hide(1))}_evtDragOver(t){t.preventDefault(),this._tabsConstrained&&t.source!==this||this._showOverlay(t.clientX,t.clientY)==="invalid"?t.dropAction="none":(t.stopPropagation(),t.dropAction=t.proposedAction)}_evtDrop(t){if(t.preventDefault(),this.overlay.hide(0),t.proposedAction==="none"){t.dropAction="none";return}let{clientX:e,clientY:i}=t,{zone:r,target:s}=x.findDropTarget(this,e,i,this._edges);if(this._tabsConstrained&&t.source!==this||r==="invalid"){t.dropAction="none";return}let l=t.mimeData.getData("application/vnd.lumino.widget-factory");if(typeof l!="function"){t.dropAction="none";return}let p=l();if(!(p instanceof A)){t.dropAction="none";return}if(p.contains(this)){t.dropAction="none";return}let c=s?x.getDropRef(s.tabBar):null;switch(r){case"root-all":this.addWidget(p);break;case"root-top":this.addWidget(p,{mode:"split-top"});break;case"root-left":this.addWidget(p,{mode:"split-left"});break;case"root-right":this.addWidget(p,{mode:"split-right"});break;case"root-bottom":this.addWidget(p,{mode:"split-bottom"});break;case"widget-all":this.addWidget(p,{mode:"tab-after",ref:c});break;case"widget-top":this.addWidget(p,{mode:"split-top",ref:c});break;case"widget-left":this.addWidget(p,{mode:"split-left",ref:c});break;case"widget-right":this.addWidget(p,{mode:"split-right",ref:c});break;case"widget-bottom":this.addWidget(p,{mode:"split-bottom",ref:c});break;case"widget-tab":this.addWidget(p,{mode:"tab-after",ref:c});break;default:throw"unreachable"}t.dropAction=t.proposedAction,t.stopPropagation(),this.activateWidget(p)}_evtKeyDown(t){t.preventDefault(),t.stopPropagation(),t.keyCode===27&&(this._releaseMouse(),C.postMessage(this,x.LayoutModified))}_evtPointerDown(t){if(t.button!==0)return;let e=this.layout,i=t.target,r=J(e.handles(),d=>d.contains(i));if(!r)return;t.preventDefault(),t.stopPropagation(),this._document.addEventListener("keydown",this,!0),this._document.addEventListener("pointerup",this,!0),this._document.addEventListener("pointermove",this,!0),this._document.addEventListener("contextmenu",this,!0);let s=r.getBoundingClientRect(),o=t.clientX-s.left,l=t.clientY-s.top,p=window.getComputedStyle(r),c=Y.overrideCursor(p.cursor,this._document);this._pressData={handle:r,deltaX:o,deltaY:l,override:c}}_evtPointerMove(t){if(!this._pressData)return;t.preventDefault(),t.stopPropagation();let e=this.node.getBoundingClientRect(),i=t.clientX-e.left-this._pressData.deltaX,r=t.clientY-e.top-this._pressData.deltaY;this.layout.moveHandle(this._pressData.handle,i,r)}_evtPointerUp(t){t.button===0&&(t.preventDefault(),t.stopPropagation(),this._releaseMouse(),C.postMessage(this,x.LayoutModified))}_releaseMouse(){this._pressData&&(this._pressData.override.dispose(),this._pressData=null,this._document.removeEventListener("keydown",this,!0),this._document.removeEventListener("pointerup",this,!0),this._document.removeEventListener("pointermove",this,!0),this._document.removeEventListener("contextmenu",this,!0))}_showOverlay(t,e){let{zone:i,target:r}=x.findDropTarget(this,t,e,this._edges);if(i==="invalid")return this.overlay.hide(100),i;let s,o,l,p,c=R.boxSizing(this.node),d=this.node.getBoundingClientRect();switch(i){case"root-all":s=c.paddingTop,o=c.paddingLeft,l=c.paddingRight,p=c.paddingBottom;break;case"root-top":s=c.paddingTop,o=c.paddingLeft,l=c.paddingRight,p=d.height*x.GOLDEN_RATIO;break;case"root-left":s=c.paddingTop,o=c.paddingLeft,l=d.width*x.GOLDEN_RATIO,p=c.paddingBottom;break;case"root-right":s=c.paddingTop,o=d.width*x.GOLDEN_RATIO,l=c.paddingRight,p=c.paddingBottom;break;case"root-bottom":s=d.height*x.GOLDEN_RATIO,o=c.paddingLeft,l=c.paddingRight,p=c.paddingBottom;break;case"widget-all":s=r.top,o=r.left,l=r.right,p=r.bottom;break;case"widget-top":s=r.top,o=r.left,l=r.right,p=r.bottom+r.height/2;break;case"widget-left":s=r.top,o=r.left,l=r.right+r.width/2,p=r.bottom;break;case"widget-right":s=r.top,o=r.left+r.width/2,l=r.right,p=r.bottom;break;case"widget-bottom":s=r.top+r.height/2,o=r.left,l=r.right,p=r.bottom;break;case"widget-tab":{const b=r.tabBar.node.getBoundingClientRect().height;s=r.top,o=r.left,l=r.right,p=r.bottom+r.height-b;break}default:throw"unreachable"}return this.overlay.show({top:s,left:o,right:l,bottom:p}),i}_createTabBar(){let t=this._renderer.createTabBar(this._document);return x.isGeneratedTabBarProperty.set(t,!0),this._mode==="single-document"&&t.hide(),t.tabsMovable=this._tabsMovable,t.allowDeselect=!1,t.addButtonEnabled=this._addButtonEnabled,t.scrollingEnabled=this._tabScrollingEnabled,t.removeBehavior="select-previous-tab",t.insertBehavior="select-tab-if-needed",t.tabMoved.connect(this._onTabMoved,this),t.currentChanged.connect(this._onCurrentChanged,this),t.tabCloseRequested.connect(this._onTabCloseRequested,this),t.tabDetachRequested.connect(this._onTabDetachRequested,this),t.tabActivateRequested.connect(this._onTabActivateRequested,this),t.addRequested.connect(this._onTabAddRequested,this),t}_createHandle(){return this._renderer.createHandle()}_onTabMoved(){C.postMessage(this,x.LayoutModified)}_onCurrentChanged(t,e){let{previousTitle:i,currentTitle:r}=e;i&&i.owner.hide(),r&&r.owner.show(),(q.IS_EDGE||q.IS_IE)&&C.flush(),C.postMessage(this,x.LayoutModified)}_onTabAddRequested(t){this._addRequested.emit(t)}_onTabActivateRequested(t,e){e.title.owner.activate()}_onTabCloseRequested(t,e){e.title.owner.close()}_onTabDetachRequested(t,e){if(this._drag)return;t.releaseMouse();let{title:i,tab:r,clientX:s,clientY:o,offset:l}=e,p=new ht,c=()=>i.owner;p.setData("application/vnd.lumino.widget-factory",c);let d=r.cloneNode(!0);l&&(d.style.top=`-${l.y}px`,d.style.left=`-${l.x}px`),this._drag=new Y({document:this._document,mimeData:p,dragImage:d,proposedAction:"move",supportedActions:"move",source:this}),r.classList.add("lm-mod-hidden");let b=()=>{this._drag=null,r.classList.remove("lm-mod-hidden")};this._drag.start(s,o).then(b)}_edges;_document;_mode;_drag=null;_renderer;_tabsMovable=!0;_tabsConstrained=!1;_addButtonEnabled=!1;_tabScrollingEnabled=!1;_pressData=null;_layoutModified=new D(this);_addRequested=new D(this)}(n=>{class t{constructor(){this.node=document.createElement("div"),this.node.classList.add("lm-DockPanel-overlay"),this.node.classList.add("lm-mod-hidden"),this.node.style.position="absolute",this.node.style.contain="strict"}node;show(r){let s=this.node.style;s.top=`${r.top}px`,s.left=`${r.left}px`,s.right=`${r.right}px`,s.bottom=`${r.bottom}px`,clearTimeout(this._timer),this._timer=-1,this._hidden&&(this._hidden=!1,this.node.classList.remove("lm-mod-hidden"))}hide(r){if(!this._hidden){if(r<=0){clearTimeout(this._timer),this._timer=-1,this._hidden=!0,this.node.classList.add("lm-mod-hidden");return}this._timer===-1&&(this._timer=window.setTimeout(()=>{this._timer=-1,this._hidden=!0,this.node.classList.add("lm-mod-hidden")},r))}}_timer=-1;_hidden=!0}n.Overlay=t;class e{createTabBar(r){let s=new W({document:r});return s.addClass("lm-DockPanel-tabBar"),s}createHandle(){let r=document.createElement("div");return r.className="lm-DockPanel-handle",r}}n.Renderer=e,n.defaultRenderer=new e})(N||(N={}));var x;(n=>{n.GOLDEN_RATIO=.618,n.DEFAULT_EDGES={top:12,right:40,bottom:40,left:40},n.LayoutModified=new ct("layout-modified"),n.isGeneratedTabBarProperty=new ut({name:"isGeneratedTabBar",create:()=>!1});function t(r){if(r.isEmpty)return{main:null};let s=Array.from(r.widgets()),o=r.selectedWidgets().next().value,l=o?s.indexOf(o):-1;return{main:{type:"tab-area",widgets:s,currentIndex:l}}}n.createSingleDocumentConfig=t;function e(r,s,o,l){if(!R.hitTest(r.node,s,o))return{zone:"invalid",target:null};let p=r.layout;if(p.isEmpty)return{zone:"root-all",target:null};if(r.mode==="multiple-document"){let _=r.node.getBoundingClientRect(),S=s-_.left+1,y=o-_.top+1,E=_.right-s,v=_.bottom-o;switch(Math.min(y,E,v,S)){case y:if(y<l.top)return{zone:"root-top",target:null};break;case E:if(E<l.right)return{zone:"root-right",target:null};break;case v:if(v<l.bottom)return{zone:"root-bottom",target:null};break;case S:if(S<l.left)return{zone:"root-left",target:null};break;default:throw"unreachable"}}let c=p.hitTestTabAreas(s,o);if(!c)return{zone:"invalid",target:null};if(r.mode==="single-document")return{zone:"widget-all",target:c};let d=c.x-c.left+1,b=c.y-c.top+1,h=c.left+c.width-c.x,a=c.top+c.height-c.y;const f=c.tabBar.node.getBoundingClientRect().height;if(b<f)return{zone:"widget-tab",target:c};let u=Math.round(c.width/3),m=Math.round(c.height/3);if(d>u&&h>u&&b>m&&a>m)return{zone:"widget-all",target:c};d/=u,b/=m,h/=u,a/=m;let g=Math.min(d,b,h,a),B;switch(g){case d:B="widget-left";break;case b:B="widget-top";break;case h:B="widget-right";break;case a:B="widget-bottom";break;default:throw"unreachable"}return{zone:B,target:c}}n.findDropTarget=e;function i(r){return r.titles.length===0?null:r.currentTitle?r.currentTitle.owner:r.titles[r.titles.length-1].owner}n.getDropRef=i})(x||(x={}));var Q;(n=>{function t(s){return i[s]}n.orientationFromPlacement=t;function e(s){return r[s]}n.directionFromPlacement=e;const i={top:"horizontal",left:"vertical",right:"vertical",bottom:"horizontal"},r={top:"top-to-bottom",left:"left-to-right",right:"right-to-left",bottom:"bottom-to-top"}})(Q||(Q={}));const Z="editor-tabBar-active";class Rt extends N{widgetAdded=new D(this);widgetActivated=new D(this);widgetRemoved=new D(this);onDidChangeCurrent=new D(this);_tabBarCurrentTitles=new WeakMap;_lastActiveTabBar;_closing=new Set;_closeScheduled=new WeakSet;closeHandler;constructor(t){super({...t,renderer:t?.renderer,spacing:1}),this.addClass("editor-dock-panel"),this._setupOverrides(),this._setupFocusHandlers(),this.closeHandler=t?.closeHandler}_setupOverrides(){const t=ft.debounce(e=>{this.markAsCurrent(e,!0)},50);this._onCurrentChanged=(e,i)=>{(i.currentTitle?.owner).setShouldFocusOnActivate(!1),t(i.currentTitle||void 0),super._onCurrentChanged.call(this,e,i)},this._onTabCloseRequested=(e,i)=>{this.closeHandler?.(i?.title.owner)||super._onTabCloseRequested.call(this,e,i)},this._onTabActivateRequested=(e,i)=>{i.title.owner.setShouldFocusOnActivate(!0),t(i.title),super._onTabActivateRequested.call(this,e,i)}}_setupFocusHandlers(){const t=new WeakMap;this.widgetAdded.connect((e,i)=>{const r=t.get(i);r&&i.node.removeEventListener("click",r);const s=o=>this._handleWidgetFocus(i);t.set(i,s),i.node.addEventListener("click",s),i.disposed.connect(()=>{i.node.removeEventListener("click",s),t.delete(i)})})}_handleWidgetFocus(t){if(t.isDisposed)return;const e=this.findTabBar(t.title);if(e){const i=e.titles.indexOf(t.title);i>=0&&(e.currentIndex=i)}this.markAsCurrent(t.title,!0)}get currentTitle(){return this._lastActiveTabBar?this._tabBarCurrentTitles.get(this._lastActiveTabBar):void 0}get currentTabBar(){return this._lastActiveTabBar}get activeWidget(){return this.currentTitle?.owner||null}markAsCurrent(t,e=!1){const i=t?this.findTabBar(t):this._lastActiveTabBar;if(!i){this._fallbackToValidTabBar();return}const r=this._tabBarCurrentTitles.get(i);if(!e&&this._lastActiveTabBar===i&&r===t)return;if(this._tabBarCurrentTitles.set(i,t),this._lastActiveTabBar=i,!t){const l=Array.from(i.titles).find(p=>p.owner.isVisible&&!p.owner.isDisposed);if(l){this._tabBarCurrentTitles.set(i,l),this.activateWidget(l.owner);return}this._tabBarCurrentTitles.delete(i),this._fallbackToValidTabBar(i);return}this.markActiveTabBar(t);const s=this._tabBarCurrentTitles.get(i);if(this.onDidChangeCurrent.emit(s),s){const o=()=>{this._tabBarCurrentTitles.get(i)===s&&this.markAsCurrent(void 0)};s.owner.disposed.disconnect(o),s.owner.disposed.connect(o)}}_fallbackToValidTabBar(t){const i=Array.from(this.tabBars()).filter(o=>o===t||o.isDisposed?!1:o.titles.some(p=>p.owner.isVisible&&!p.owner.isDisposed));if(i.length===0){this._lastActiveTabBar=void 0,this.onDidChangeCurrent.emit(void 0);return}let r=i.find(o=>o===this._lastActiveTabBar)||i[0],s=this._tabBarCurrentTitles.get(r);(!s||s.owner.isDisposed||!s.owner.isVisible)&&(s=r.titles.find(o=>o.owner.isVisible&&!o.owner.isDisposed)),s&&(this._tabBarCurrentTitles.set(r,s),this._lastActiveTabBar=r,this.activateWidget(s.owner),this.markActiveTabBar(s),this.onDidChangeCurrent.emit(s),this.markAsCurrent(s,!0))}markActiveTabBar(t){const e=Array.from(this.tabBars());e.forEach(r=>r.removeClass(Z));const i=t?this.findTabBar(t):this._lastActiveTabBar||(e.length>0?e[0]:void 0);i&&i.addClass(Z)}findTabBar(t){return Array.from(this.tabBars()).find(e=>e.titles.includes(t))}addWidget(t,e){if(this.mode==="single-document"&&t.parent===this)return;super.addWidget(t,e),this.widgetAdded.emit(t),this.markActiveTabBar(t.title);const i=this.findTabBar(t.title);if(!i)return;const r=t.node.dataset.resourceUri?.toString();for(const s of Array.from(i.titles)){const o=s.owner;if(o===t)continue;if(o.node.dataset.resourceUri?.toString()===r){try{i.removeTab(s)}catch(d){console.warn("Failed to remove duplicate tab:",d)}const p=Array.from(this.tabBars()).filter(d=>d.titles.includes(o.title)),c=Array.from(this.widgets()).includes(o);p.length===0&&!c&&!o.isDisposed&&this._scheduleCloseAndDispose(o)}}}activateWidget(t){super.activateWidget(t),this.widgetActivated.emit(t),this.markAsCurrent(t.title,!0)}onChildRemoved(t){super.onChildRemoved(t);try{const i=t.child;if(!this._closing.has(i)){const s=Array.from(this.tabBars()).some(l=>l.titles.includes(i.title)),o=Array.from(this.widgets()).includes(i);!s&&!o&&!i.isDisposed&&this._scheduleCloseAndDispose(i)}}catch{}const e=this.findTabBar(t.child.title);e&&this._tabBarCurrentTitles.get(e)?.owner===t.child&&this.markAsCurrent(void 0),this.widgetRemoved.emit(t.child)}closeAllInTabBar(t){const e=t||this._lastActiveTabBar;if(!e)return;Array.from(e.titles).forEach(r=>{r.owner.isDisposed||r.owner.close()}),this._tabBarCurrentTitles.delete(e),this._fallbackToValidTabBar(e)}_scheduleCloseAndDispose(t){if(!(this._closing.has(t)||this._closeScheduled.has(t))){this._closing.add(t),this._closeScheduled.add(t);try{t.close()}catch{}setTimeout(()=>{try{const e=Array.from(this.tabBars()).some(r=>r.titles.includes(t.title)),i=Array.from(this.widgets()).includes(t);if(!e&&!i&&!t.isDisposed)try{t.dispose()}catch(r){console.warn("Failed to force dispose widget:",r)}}catch(e){console.warn("Error in close/dispose fallback:",e)}finally{this._closing.delete(t),this._closeScheduled.delete(t)}},30)}}}class Nt extends N.Renderer{_onSplit;set onSplit(t){this._onSplit=t}createTabBar(t){const e=super.createTabBar(t),i=this._createToolbars(e);return e.node.appendChild(i),e.addClass("editor-tabBar"),e}_createToolbars(t){const e=document.createElement("div");e.className="lm-TabBar-toolbars";const i=this._createSplitButton("vertical","split-vertical","",t);e.appendChild(i);const r=this._createSplitButton("horizontal","split-horizontal","",t);return e.appendChild(r),e}_createSplitButton(t,e,i,r){const s=document.createElement("div");return s.className=`lm-TabBar-splitButton lm-split-${t}`,s.title=i,s.innerHTML=`<span class="codicon codicon-${e} action-label"></span>`,s.addEventListener("click",o=>{o.stopPropagation(),o.preventDefault(),this._onSplit&&this._onSplit(t,r)}),s}}function Wt(n){const t=n.dockPanel,e=n.getCommands;if(!t){console.warn("createEditorContextMenu: dockPanel not available");return}let i=null;e.addCommand("editor:close",{label:"",execute:()=>{const o=i||n.activeEditor;o&&n.closeCurrent(o),i=null}}),e.addCommand("editor:close-others",{label:"",execute:()=>{const o=i||n.activeEditor;o&&n.closeOthers(o),i=null}}),e.addCommand("editor:close-right",{label:"",execute:()=>{const o=i||n.activeEditor;o&&n.closeRight(o),i=null}}),e.addCommand("editor:close-all",{label:"",execute:()=>{const o=i||n.activeEditor;o&&n.closeAll("tabbar",o),i=null}}),e.addCommand("editor:split-left",{label:"",execute:()=>{const o=i||n.activeEditor;n.split("left",o).finally(()=>i=null)}}),e.addCommand("editor:split-right",{label:"",execute:()=>{const o=i||n.activeEditor;n.split("right",o).finally(()=>i=null)}}),e.addCommand("editor:split-top",{label:"",execute:()=>{const o=i||n.activeEditor;n.split("top",o).finally(()=>i=null)}}),e.addCommand("editor:split-bottom",{label:"",execute:()=>{const o=i||n.activeEditor;n.split("bottom",o).finally(()=>i=null)}});const r=new bt({commands:e});r.title.label="",r.title.iconClass="codicon-split-horizontal",r.addItem({command:"editor:split-left"}),r.addItem({command:"editor:split-right"}),r.addItem({command:"editor:split-top"}),r.addItem({command:"editor:split-bottom"});const s=new pt({commands:e});s.addItem({command:"editor:close",selector:".lm-TabBar-tab"}),s.addItem({command:"editor:close-others",selector:".lm-TabBar-tab"}),s.addItem({command:"editor:close-right",selector:".lm-TabBar-tab"}),s.addItem({command:"editor:close-all",selector:".lm-TabBar-tab"}),s.addItem({type:"separator",selector:".lm-TabBar-tab"}),s.addItem({type:"submenu",submenu:r,selector:".lm-TabBar-tab"}),t.node.addEventListener("contextmenu",o=>{const p=o.target.closest(".lm-TabBar-tab");if(p){const c=p.closest(".lm-TabBar");if(c){const b=Array.from(t.tabBars()).find(h=>h.node===c);if(b){const a=Array.from(c.querySelectorAll(".lm-TabBar-tab")).indexOf(p);a>=0&&a<b.titles.length&&(i=b.titles[a].owner)}}}else i=null;s.open(o)&&o.preventDefault()})}var Ht=Object.getOwnPropertyDescriptor,Pt=(n,t,e,i)=>{for(var r=i>1?void 0:i?Ht(t,e):t,s=n.length-1,o;s>=0;s--)(o=n[s])&&(r=o(r)||r);return r},I=(n,t)=>(e,i)=>t(e,i,n);let X=class{constructor(n,t,e,i,r,s,o,l,p){this.commands=n,this.strategyManager=t,this.keybindingRegistry=e,this.editorService=i,this.notificationService=r,this.fileSystemService=s,this.filePersistenceService=o,this.quickInput=l,this.storageService=p;const c=new Nt;c.onSplit=this._handleSplit.bind(this),this._dockPanel=new Rt({renderer:c,tabsMovable:!0,mode:"multiple-document",addButtonEnabled:!1,tabScrollingEnabled:!0,closeHandler:d=>this.closeCurrent(d)}),this.disposables.trackEvent(d=>this.fileSystemService.onDidFileDataChange.connect(d),d=>this.fileSystemService.onDidFileDataChange.disconnect(d),(d,b)=>{for(const[h,a]of this._index)for(const f of a)b.uri.toString()===h&&f instanceof U&&(f.setFileName(b.data.name),f.setDirty(b.isDirty))}),this.fileSystemService.onDidFileStateChange.connect((d,b)=>{for(const[h,a]of this._index)for(const f of a)if(b.uri.toString()===h&&f instanceof U)switch(b.loadStatus){case"loading":f.showLoading();break;case"success":f.hideLoading();break;case"failed":console.log(b.loadError),f.node.innerHTML=`<div class="resource-empty"><span class='codicon codicon-error error'></span><p></p></div>`;break}}),this.disposables.trackEvent(d=>this._dockPanel.widgetAdded.connect(d),d=>this._dockPanel.widgetAdded.disconnect(d),(d,b)=>{this._indexWidget(b)}),this.disposables.trackEvent(d=>this._dockPanel.widgetRemoved.connect(d),d=>this._dockPanel.widgetRemoved.disconnect(d),(d,b)=>{this._unindexWidget(b),this._activeEditor===b&&this._updateActiveEditorAfterRemoval()}),this.disposables.trackEvent(d=>this._dockPanel.onDidChangeCurrent.connect(d),d=>this._dockPanel.onDidChangeCurrent.disconnect(d),(d,b)=>{const h=b?.owner||null;h!==this._activeEditor&&(this._activeEditorChanged.emit(h),this._activeEditor=h)}),Wt(this),this.commands.addCommand("editor:save",{label:"",isEnabled:()=>this.activeEditor!==null,execute:()=>{this._handleSave()}}),this.commands.addCommand("editor:saveAll",{label:"",isEnabled:()=>this.fileSystemService.getDirtyFileUris().length>0,execute:()=>{this.filePersistenceService.saveAll()}})}disposables=new mt;_dockPanel;_index=new Map;_activeEditor=null;_editorAdded=new D(this);_editorRemoved=new D(this);_activeEditorChanged=new D(this);get dockPanel(){return this._dockPanel}get activeEditor(){return this._activeEditor}get editorAdded(){return this._editorAdded}get editorRemoved(){return this._editorRemoved}get activeEditorChanged(){return this._activeEditorChanged}get getCommands(){return this.commands}getStrategy(n){return this.strategyManager.getStrategy(n)}_handleSave(){this.save()}_doTest(n){const t=this.activeEditor;if(t){const e=this.getUnifiedResourceUri(t);this.fileSystemService.doTest(e,n)}}_handleSplit(n,t){const e=t.currentIndex;if(e===-1)return;const r=t.titles[e].owner;let s;switch(n){case"vertical":s="bottom";break;case"horizontal":s="right";break;default:return}this.split(s,r)}async open(n,t){const e=t,i=e.forceNew||!1,r=e.mode,s=e.ref??void 0,o=n.toString();if(!i){const d=this._index.get(o);if(d&&d.size>0){if(s){const b=this._dockPanel.findTabBar(s.title);if(b){const h=Array.from(b.titles).map(a=>a.owner).find(a=>this.getUnifiedResourceUri(a).toString()===o);if(h)return this.reveal(h),h}}else if(this._activeEditor){const b=this._dockPanel.findTabBar(this._activeEditor.title);if(b){const h=Array.from(b.titles).map(a=>a.owner).find(a=>this.getUnifiedResourceUri(a).toString()===o);if(h)return this.reveal(h),h}}if(!t.allowMultiple&&d.size>0){const b=Array.from(d.values())[0];return this.reveal(b),b}}}let l=await this.createEditorWidget(n,t);const p=this._activeEditor&&!this._activeEditor.isDisposed&&this._isWidgetInDock(this._activeEditor)?this._activeEditor:void 0,c=s??p??void 0;return l.ref=c,this._dockPanel.addWidget(l,{mode:r,ref:c}),this.reveal(l),this._editorAdded.emit(l),l}async createEditorWidget(n,t){let e,i;const r=this.getOpenEditors(n);if(r.length>0)i=this.getUnifiedEditorOptions(r[0]),e=await this.editorService.createWidget(n,i);else try{i={...t},e=await this.editorService.createWidget(n,i),e.showLoading()}catch(s){e=new Ct(n,t),e.hideLoading(),console.log(s)}return this._indexWidget(e),e}reveal(n){!n||n.isDisposed||(this._dockPanel.activateWidget(n),this._activeEditor=n,this._activeEditorChanged.emit(n))}async split(n,t){const e=t||this._activeEditor;if(!e)return console.warn(""),null;const i=this.getUnifiedResourceUri(e),r=this.getUnifiedEditorOptions(e),o=this.getStrategy(e).getSplitOptions(e);let l;switch(n){case"left":l="split-left";break;case"right":l="split-right";break;case"top":l="split-top";break;case"bottom":l="split-bottom";break;default:return null}const p=this._dockPanel.findTabBar(e.title);if(p){const b=Array.from(p.titles).map(h=>h.owner).find(h=>h!==e&&this.getUnifiedResourceUri(h)===i);if(b)return this.reveal(b),b}if(!r.allowMultiple){const b=this._index.get(i.toString());if(b&&b.size>0){const h=Array.from(b.values()).find(a=>a===e);if(h&&h===e)return this._dockPanel.addWidget(h,{mode:l,ref:e}),this.reveal(h),h}}const c={...r,...o},d=await this.editorService.createWidget(i,c);return this._indexWidget(d),this._dockPanel.addWidget(d,{mode:l,ref:e}),this.reveal(d),this._editorAdded.emit(d),d}async save(){if(!this._activeEditor)return!1;const n=this.getUnifiedResourceUri(this._activeEditor);return await this.filePersistenceService.saveFile(n),!0}async _saveWidget(n){if(!n||n.isDisposed)return!1;const t=n.resourceUri;return await this.filePersistenceService.saveFile(t)}async _checkDirtyBeforeClose(n){if(!(n instanceof U))return!0;const t=n,e=t.resourceUri;if(!t.options.isDirty||this.getOpenEditors(e).length>1)return!0;this._activeEditor!==t&&(this.reveal(t),await new Promise(o=>setTimeout(o,150)));const r=t.options.name||e.path.split("/").pop()||e;switch(await gt.openSaveConfirm(` "${r}" `)){case"save":return await this._saveWidget(t);case"discard":return!0;case"cancel":return!1;default:return!1}}async _closeTab(n,t){if(!n||n.isDisposed)return!0;if(!await this._checkDirtyBeforeClose(n))return!1;const i=Array.from(this._dockPanel.tabBars()).filter(r=>r.titles.includes(n.title));if(t&&i.length>1){if(t.titles.indexOf(n.title)!==-1)try{t.removeTab(n.title)}catch(s){return console.warn("Failed to remove tab from tabBar",s),!1}return!0}try{return n.close(),!0}catch(r){return console.warn("Failed to close widget",r),!1}}closeOpenedEditor(n){const t=this._index.get(n.toString());console.log(t)}async closeCurrent(n){const t=n||this._activeEditor;if(!t)return;const e=this._dockPanel.findTabBar(t.title);await this._closeTab(t,e)}async closeOthers(n){const t=n||this._activeEditor;if(!t)return;const e=this._dockPanel.findTabBar(t.title);if(!e)return;const i=Array.from(e.titles);for(const r of i){if(r.owner===t)continue;if(!await this._closeTab(r.owner,e))break}}async closeRight(n){const t=n||this._activeEditor;if(!t)return;const e=this._dockPanel.findTabBar(t.title);if(!e)return;const i=Array.from(e.titles),r=i.indexOf(t.title);if(r===-1)return;const s=i.slice(r+1);for(const o of s)if(!await this._closeTab(o.owner,e))break}async closeAll(n="tabbar",t){let e=[];if(n==="global")e=this.getAllOpenEditors().filter(i=>!i.isDisposed);else{const i=t||this._activeEditor;if(!i)return;const r=this._dockPanel.findTabBar(i.title);if(!r)return;e=Array.from(r.titles).map(s=>s.owner).filter(s=>!s.isDisposed)}for(const i of e)if(!await this._closeTab(i))break}getUnifiedResourceUri(n){return n.resourceUri}getUnifiedEditorOptions(n){return n.options}_indexWidget(n){const t=this.getUnifiedResourceUri(n);let e=this._index.get(t.toString());e||(e=new Set,this._index.set(t.toString(),e)),e.add(n),n.disposed.connect(()=>{this._unindexWidget(n),this._editorRemoved.emit(n),this._activeEditor===n&&this._updateActiveEditorAfterRemoval()})}_unindexWidget(n){const t=this.getUnifiedResourceUri(n),e=this._index.get(t.toString());e&&(e.delete(n),e.size===0&&this._index.delete(t.toString()))}getOpenEditors(n){const t=this._index.get(n.toString());return t?Array.from(t):[]}getAllOpenEditors(){const n=[];for(const t of this._index.values())n.push(...Array.from(t));return n}_isWidgetInDock(n){if(!n||n.isDisposed)return!1;for(const t of this._dockPanel.widgets())if(t===n)return!0;return!1}_updateActiveEditorAfterRemoval(){const n=this._dockPanel.currentTitle;if(n&&n.owner&&!n.owner.isDisposed){this._activeEditor=n.owner,this._activeEditorChanged.emit(this._activeEditor);return}for(const t of this._dockPanel.widgets())if(t&&!t.isDisposed&&t.isVisible){this._activeEditor=t,this._activeEditorChanged.emit(this._activeEditor);return}this._activeEditor=null,this._activeEditorChanged.emit(null)}saveLayoutData(){const n=this._dockPanel.saveLayout(),t={},e=r=>{if(r)if(r.type==="tab-area"){for(const s of r.widgets)if(s&&s instanceof U&&!s.isDisposed){const o=this.getUnifiedEditorOptions(s);t[s.id]={resourceUri:s.resourceUri.toString(),editorOptions:{name:o.name,forceNew:!0,allowMultiple:o.allowMultiple,language:o.language}}}}else r.type==="split-area"&&r.children.forEach(e)};e(n.main);const i=this.deflateState(n.main);this.storageService.setData("editor-layout",{dockLayout:{main:JSON.parse(i)},activeWidgetId:this._activeEditor?this._activeEditor.id:null,editorMap:t})}async restoreLayoutData(){const n=await this.storageService.getData("editor-layout");if(!n)return;const{dockLayout:t,activeWidgetId:e,editorMap:i}=n;if(!(!t||!i)){await this.closeAll("global"),this._index.clear();try{const r=await this.convertToWidget(i);this.updateLayoutWidgetRefs(t.main,r),this._dockPanel.restoreLayout(t),this.saveLayoutData(),setTimeout(()=>{e&&r[e]&&this.reveal(r[e])},100)}catch(r){console.error(":",r)}}}async convertToWidget(n){const t={},e=Object.entries(n);for(const[i,{resourceUri:r,editorOptions:s}]of e)try{let o=await this.open(_t.parse(r),s);t[i]=o}catch(o){throw o}return t}updateLayoutWidgetRefs(n,t){n&&(n.type==="tab-area"?n.widgets=n.widgets.map(e=>t[e.id]||e):n.type==="split-area"&&n.children.forEach(e=>this.updateLayoutWidgetRefs(e,t)))}deflateState(n){return JSON.stringify(n,(t,e)=>{if(!(t==="_parent"||t==="_layout"||t==="_dockPanel")&&!(e&&e.constructor&&e.constructor.name==="Signal")&&!(e instanceof HTMLElement)&&!t.startsWith("_"))return e instanceof U?{id:e.id,name:e.options.name}:e})}inflateState(n){return JSON.parse(n)}dispose(){this.disposables.dispose()}};X=Pt([tt(),I(0,L(vt)),I(1,L(F)),I(2,L(Tt)),I(3,L(it)),I(4,L(yt)),I(5,L(Bt)),I(6,L(Et)),I(7,L(xt)),I(8,L(St))],X);function qt(n){n(it).toSelf().inSingletonScope(),n(F).toSelf().inSingletonScope(),n(X).toSelf().inSingletonScope(),n(et).to(rt),wt(n,Dt)}export{Xt as DocumentModelService,Dt as EditorProvider,it as EditorService,et as EditorStrategy,At as EditorType,U as EditorWidget,Ct as ErrorEditorWidget,Gt as ResourceEditStack,Yt as UndoRedoService,qt as bindEditorModule};
